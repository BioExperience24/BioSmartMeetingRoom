@page "/user"
@model _1.PAMA.Razor.Views.Pages.User.IndexModel
@{
    Layout = "_LayoutAdmin";
    ViewData["PageName"] = "User";
}

@section Styles {
    <link href="~/assets/theme/plugins/jquery-datatable/skin/bootstrap/css/dataTables.bootstrap.css" rel="stylesheet">
    <link href="~/assets/theme/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css" rel="stylesheet" />
    <link href="~/assets/external/filepond/filepond.min.css" rel="stylesheet">
}

<section class="content">
    <div class="container-fluid">
        <div class="block-header">
            <h2>@ViewData["PageName"]</h2>
        </div>

        <div class="row clearfix">
            <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                <div class="info-box bg-blue hover-expand-effect">
                    <div class="icon">
                        <i class="material-icons">supervisor_account</i>
                    </div>
                    <div class="content">
                        <div class="text">GROUP</div>
                        <div class="number count-to-group" data-speed="15" data-fresh-interval="20"></div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-8 col-sm-6 col-xs-12">
                <div class="info-box bg-orange hover-expand-effect">
                    <div class="icon">
                        <i class="material-icons">account_circle</i>
                    </div>
                    <div class="content">
                        <div class="text">USER</div>
                        <div class="number count-to-user" data-speed="1000" data-fresh-interval="20"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row clearfix">
            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
                <div class="card">
                    <div class="header">

                        <div class="row clearfix">
                            <div class="col-xs-12 col-sm-6">
                                <h2>Group List</h2>
                            </div>
                            <div class="col-xs-12 col-sm-6 align-right">
                
                            </div>
                        </div>
                    </div>
                    <div class="body table-responsive responsive">
                        <table class="table table-hover" id="tbldataGroup">
                            <thead>
                                <th>#</th>
                                <th>Group Name</th>
                                <th>Detail</th>
                            </thead>
                            <tbody>
                            </tbody>
                            </table>
                    </div>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-8 col-lg-8">
                <div class="card">
                    <div class="header">

                        <div class="row clearfix">
                            <div class="col-xs-12 col-sm-6">
                                <h2>User List</h2>
                            </div>
                            <div class="col-xs-12 col-sm-6 align-right">
                
                            </div>
                        </div>
                    </div>
                    <div class="body table-responsive responsive">
                        <table class="table table-hover" id="tbldataUser">
                            <thead>
                                <th>#</th>
                                <th>Name</th>
                                <th>Group</th>
                                <th>Username</th>
                                <th>Password</th>
                                <th>
                                    <button 
                                    onclick="createData($(this))" 
                                    data-id="" 
                                    data-name="" 
                                    type="button" class="btn btn-primary waves-effect">CREATE</button>
                                </th>
                            </thead>
                            <tbody>
                            </tbody>
                            </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="id_mdl_create" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="idmdlcrLabel">Create User </h4>
            </div>
            <div class="modal-body " id="id_mdl_create_body">
                <form id="frm_create">
                    <label for="">Employee Data</label>
                    <div class="form-group">
                        <select onchange="oncEmploy($(this), $('#id_crt_username'))" data-live-search="true" name="employee_id" id="id_crt_employee_id" class="form-control show-tick"></select>
                    </div>

                    <label for="">Username <b style="color:red;">*</b></label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" autocomplete="off" name="username" id="id_crt_username" required=""  class="form-control" placeholder="Name">
                        </div>
                    </div>
                    
                    <label for="">Password <b style="color:red;">*</b></label>
                    <div class="form-group">
                        <div class="input-group">
                            
                            <div class="form-line">
                                <input type="password" name="password" class="form-control" placeholder="Password" id="id_crt_password">
                            </div>
                            <span class="input-group-addon" onclick="showPass($('#id_crt_password'), $('#id_crt_area_icon_password'))" id="id_crt_area_icon_password">
                                <i style="font-size: 28px;" class="material-icons waves-effect ">lock_outline</i>
                            </span>
                        </div>
                    </div>
                    <label for="">Group <b style="color:red;">*</b></label>
                    <div class="form-group">
                        <select  data-live-search="true" name="level_id" id="id_crt_level_id" class="form-control show-tick"></select>
                    </div>
                    <label for="">User Access <b style="color:red;">*</b></label>
                    <div class="form-group">
                        <select multiple data-live-search="true" name="access_id[]" id="id_crt_access_id" class="form-control show-tick"></select>
                    </div>
                    <label for="">Activate Status <b style="color:red;">*</b></label>
                    <div class="form-group">
                        <select  name="is_disactived" id="id_crt_activate_id" class="form-control show-tick">
                            <option value="0">On</option>
                            <option value="1">Off</option>
                        </select>
                    </div>
                    
                    <br>
                    <button style="display: none;" id="id_btn_crt_submit" type="submit" class="btn btn-primary m-t-15 waves-effect">Save</button>
                </form>
            </div>
            <div class="modal-footer">
                <div class="row clearfix">
                    <div class="col-xs-6 align-left">
                        <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
                    </div>
                    <div class="col-xs-6">
                        <button onclick="clickSubmit('id_btn_crt_submit')" type="button" class="btn btn-primary waves-effect " >SAVE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="id_mdl_detail_group" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="idmdlcrLabel">Detail Group <b id="id_text_detail_name"></b></h4>
            </div>
            <div class="modal-body ">
                <form id="frm_detail_datail">
                    <label for="">Name</label>
                    <div class="form-group">
                        <div class="form-line">
                            <input type="text" autocomplete="off" name="name" id="id_detail_name" required=""  class="form-control" placeholder="Name">
                            <input type="hidden" name="id" id="id_detail_id" >
                        </div>
                    </div> 
                    <label for="">Privileges</label>
                    <div class="form-group" id="id_area_privileges" style="height: 300px; overflow-y: scroll;overflow-x: hidden;">
                        
                    </div>
                    <div class="form-group">
                        <button hidden="" type="submit" id="id_btn_detail_submit"></button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <div class="row clearfix">
                    <div class="col-xs-6 align-left">
                        <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
                    </div>
                    <div class="col-xs-6">
                            <button onclick="clickSubmit('id_btn_detail_submit')" type="button" class="btn btn-primary waves-effect " >SAVE</button>
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="id_mdl_update" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="idmdlcrLabel">Detail User <b></b></h4>
            </div>
            <div class="modal-body " >
                <form id="frm_update">
                    
                            <label for="">Username <b style="color:red;">*</b></label>
                            <div class="form-group">
                                <div class="form-line">
                                    <input type="text" autocomplete="off" name="username" id="id_edt_username" required=""  class="form-control" placeholder="Name">
                                <input type="hidden" name="id" id="id_edt_id" required="" >
                                </div>
                            </div>
                            
                            <label for="">Password <b style="color:red;">*</b></label>
                            <div class="form-group">
                                <div class="input-group">
                                    <div class="form-line">
                                        <input type="password" name="password" class="form-control" placeholder="Password" id="id_edt_password">
                                    </div>
                                    <span class="input-group-addon" onclick="showPass($('#id_edt_password'), $('#id_edt_area_icon_password'))" id="id_edt_area_icon_password">
                                        <i style="font-size: 28px;" class="material-icons waves-effect ">lock_outline</i>
                                    </span>
                                </div>
                            </div>
                            <label for="">Group <b style="color:red;">*</b></label>
                            <div class="form-group">
                                <select  data-live-search="true" name="level_id" id="id_edt_level_id" class="form-control show-tick"></select>
                            </div>

                            <label for="">User Access <b style="color:red;">*</b></label>
                            <div class="form-group">
                                <select multiple data-live-search="true" name="access_id[]" id="id_edt_access_id" class="form-control show-tick"></select>
                            </div>
                            
                            <label for="">Activate Status <b style="color:red;">*</b></label>
                            <div class="form-group">
                                <select  name="is_disactived" id="id_edt_activate_id" class="form-control show-tick">
                                    
                                </select>
                            </div>
                            <button style="display: none;" id="id_btn_edt_submit" type="submit" class="btn btn-primary m-t-15 waves-effect">Save</button>
                </form>
            </div>
            <div class="modal-footer">
                <div class="row clearfix">
                    <div class="col-xs-6 align-left">
                        <button onclick="clickSubmit('id_btn_edt_submit')" type="button" class="btn btn-primary waves-effect " >UPDATE</button>
                    </div>
                    <div class="col-xs-6">
                        <button type="button" class="btn btn-link waves-effect" data-dismiss="modal">CLOSE</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<textarea id="id_modules" style="display: none;">{"booking":{"module_id":"9","module_text":"module_booking","name":"Module booking","module_serial":null,"is_enabled":"1"},"pantry":{"module_id":"5","module_text":"module_pantry","name":"Module Pantry","module_serial":null,"is_enabled":"1"},"desk":{"module_id":"23","module_text":"module_desk","name":"Module Desk","module_serial":null,"is_enabled":"1"},"room_adv":{"module_id":"32","module_text":"module_room_advance","name":"Module Room","module_serial":null,"is_enabled":"1"}}</textarea> 
<textarea id="id_access" style="display: none;">[{"access_id":"1","access_name":"Booking Meeting","is_active":"1"},{"access_id":"2","access_name":"Order Pantry","is_active":"1"},{"access_id":"3","access_name":"Booking Desk","is_active":"1"},{"access_id":"4","access_name":"Approval","is_active":"1"}]</textarea> 

@section Scripts {
    <script src="~/assets/theme/plugins/jquery-datatable/jquery.dataTables.js"></script>
    <script src="~/assets/theme/plugins/jquery-datatable/skin/bootstrap/js/dataTables.bootstrap.js"></script>
    <script src="~/assets/theme/plugins/sweatalert2/sweetalert2.all.min.js"></script>
    <!-- Moment Plugin Js -->
    <script src="~/assets/theme/plugins/momentjs/moment.js"></script>
    <!-- Bootstrap Material Datetime Picker Plugin Js -->
    <script src="~/assets/theme/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js"></script>
    <script src="~/assets/external/numeral/numeral.min.js"></script>
    <script src="~/assets/external/numeral/locale.id.js"></script>
    @* <input type="hidden" id="id_baseurl" value="<?= base_url()?>">
    <input type="hidden" id="id_username" value="<?= $this->session->userdata('user-nya')?>"> *@
    <script>
        const ajax = {
            url : {
                get_groups : "@Model.GetLevels",
                get_group_detail : "@Model.GetLevelDescByLevelId",
                post_update_group : "@Model.UpdateLevel",
                get_users : "@Model.GetUsers",
                get_employees : "@Model.GetEmployeesWithoutUser",
                get_employee_by_id : "@Model.GetEmployeeById",
                post_create_user : "@Model.CreateUser",
                get_user_by_id : "@Model.GetUserById",
                post_update_user: "@Model.UpdateUser",
                post_delete_user: "@Model.DeleteUser",
                post_disable_user: "@Model.DisableUser"
            }
        }
    </script>
    
    <script>
        var uploadimageCrt = false;
        var gAutomation = [];
        var gFacility= [];
        var dataGroup = [];
        var selActivate = ["On", "Off"];
        var assetsImageUrl = "";
        $(function(){
            initGroup();
            init();
            $('#frm_create').validate({
                rules: {
                    'level_id': {
                        valueNotEquals: true,
                    },
                    'employee_id': {
                        valueNotEquals: true,
                    },
                },
                highlight: function (input) {
                    $(input).parents('.form-line').addClass('error');
                },
                unhighlight: function (input) {
                    $(input).parents('.form-line').removeClass('error');
                },
                errorPlacement: function (error, element) {
                    console.log(element)
                    $(element).parents('.form-group').append(error);
                },
                submitHandler: function(form) {
                }

            });
            $('#frm_update').validate({
                rules: {
                    'level_id': {
                        valueNotEquals: true,
                    },
                    
                },
                highlight: function (input) {
                    $(input).parents('.form-line').addClass('error');
                },
                unhighlight: function (input) {
                    $(input).parents('.form-line').removeClass('error');
                },
                errorPlacement: function (error, element) {
                    console.log(element)
                    $(element).parents('.form-group').append(error);
                },
                submitHandler: function(form) {
                }

            });
        }) 
        function initPassword(){
            $('#id_crt_password').attr("type", "password");
            $('#id_edt_password').attr("type", "password");
            var html = '<i style="font-size: 28px;" class="material-icons waves-effect ">lock_outline</i>'
            $('#id_edt_area_icon_password').html(html)
            $('#id_crt_area_icon_password').html(html)
        }
        function showPass(selector1, selector2){
            var type = selector1.attr("type");
            var html = "";
            if(type == "password"){
                html = '<i style="font-size: 28px;" class="material-icons waves-effect ">lock_open</i>'
                type = "text";
            }else{
                html = '<i style="font-size: 28px;" class="material-icons waves-effect ">lock_outline</i>'
                type = "password";
            }
            selector1.attr('type', type);
            selector2.html(html)
        }
        $.validator.addMethod("valueNotEquals", function(value, element, arg){
          return value != "";
        }, "Choose selection item .");
        
        function clickSubmit(id){
            // console.log(id)
            $('#'+id).click();
        }
        function getModule(){
            var modules = $('#id_modules').val();
            return JSON.parse(modules)
        }
        function getAccess(){
            var data = $('#id_access').val();
            return JSON.parse(data)
        }
        function initTable(
                selector, search = true, lengthChange=true, 
                iDisplayLength =10, paging = true,
                sZeroRecords = 'No matching records found' ){
            selector.DataTable({
                "paging": paging,
                "searching": search,
                "lengthChange": lengthChange,
                "iDisplayLength": iDisplayLength,
                "aLengthMenu": [[5, 10, 25, 50, -1], [5, 10, 25, 50, "All"]],
                "oLanguage": {
                  "sZeroRecords": sZeroRecords
                },
            });
        }
        function clearTable(selector){
            selector.DataTable().destroy();
        }
        function select_enable(){
            $('select').selectpicker("refresh");
            $('select').selectpicker("initialize");
        }
        function enable_datetimepicker(){
            $('.timepicker').bootstrapMaterialDatePicker({
                format: 'HH:mm',
                clearButton: true,
                date: false
            });
        }
        function oncEmploy(t, selectorinput){
            var bs = $('#id_baseurl').val();
            var id = t.val();
            $.ajax({
                @* url : bs+"employee/get/edit/"+id, *@
                url : ajax.url.get_employee_by_id + `/${id}`,
                type : "GET",
                dataType: "json",
                beforeSend: function(){
                },
                success:function(data){
                    if(data.status == "success"){
                        var col = data.collection;
                        selectorinput.val(col['nik']);
                    }else{
                        selectorinput.val("");
                    }
                },
                error: errorAjax
            })

        }
        function createData(){
            initPassword();
            var bs = $('#id_baseurl').val();
            $.ajax({
                @* url : bs+"user/get/notuser", *@
                url : ajax.url.get_employees,
                type : "GET",
                dataType: "json",
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        var dataemployee = "";
                        var datagroup = "";
                        var htmlAccessSel = "";
                        dataemployee += '<option value="">Choose Employee</option>';
                        datagroup += '<option value="">Choose Group</option>';
                        $.each(data.collection,function(index, item){
                            dataemployee += '<option value="'+item.id+'" >'+item.name+'</option>';
                        })
                        $.each(dataGroup, (index,item)=>{
                            datagroup += '<option value="'+item.id+'">'+item.name+'</option>';
                        })
                        var listAccess = getAccess();
                        $.each(listAccess, (index,item)=>{
                            htmlAccessSel += '<option value="'+item.access_id+'">'+item.access_name+'</option>';
                        });

                        $('#id_crt_access_id').html(htmlAccessSel);

                        $('#id_crt_employee_id').html(dataemployee);
                        $('#id_crt_level_id').html(datagroup);
                        $('#id_mdl_create').modal('show');
                        enable_datetimepicker()
                        select_enable()
                    }else{
                        var msg = "Your session is expired, login again !!!";
                        showNotification('alert-danger', msg,'top','center')
                    }
                    $('#id_loader').html('');
                },
                error: errorAjax
            })
            
        }
        $('#frm_detail_datail').submit(function(e){
            e.preventDefault();
            var form =  $('#frm_detail_datail').serialize();
            var bs = $('#id_baseurl').val();
            $.ajax({
                @* url : bs+"user/post/update/group", *@
                url : ajax.url.post_update_group,
                type : "POST",
                dataType: "json",
                data:  form,
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        $('#frm_detail_datail')[0].reset();
                        initGroup();
                        $('#id_mdl_detail_group').modal('hide');
                          showNotification('alert-success', data.msg,'top','center')
                    }else{
                          showNotification('alert-danger', data.msg,'top','center')
                    }
                    $('#id_loader').html('');
                    },
                error: errorAjax
            })
        }) 
        $('#frm_create').submit(function(e){
            e.preventDefault();
            var form =  $('#frm_create').serialize();
            var bs = $('#id_baseurl').val();
            if ($(this).valid() == false) {
                return false;
            }
            $.ajax({
                @* url : bs+"user/post/user/create", *@
                url : ajax.url.post_create_user,
                type : "POST",
                dataType: "json",
                data:  form,
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        $('#frm_create')[0].reset();
                        init();
                        $('#id_mdl_create').modal('hide');
                          showNotification('alert-success', data.msg,'top','center')
                    }else{
                          showNotification('alert-danger', data.msg,'top','center')
                    }
                    $('#id_loader').html('');
                    },
                error: errorAjax
            })
        })  
        $('#frm_update').submit(function(e){
            e.preventDefault();
            var form = $('#frm_update').serialize();
            var bs = $('#id_baseurl').val();
            if ($(this).valid() == false) {
                return false;
            }
            $.ajax({
                @* url : bs+"user/post/user/update", *@
                url : ajax.url.post_update_user,
                type : "POST",
                dataType: "json",
                data : form,
                // data:  new FormData(this),
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        $('#frm_update')[0].reset();
                        $('#id_mdl_update').modal('hide');
                        init();
                        showNotification('alert-success', data.msg,'top','center')
                    }else{
                        showNotification('alert-danger', data.msg,'top','center')
                    }
                    $('#id_loader').html('');
                },
                error: errorAjax
            })
        })
        function init(){
            var bs = $('#id_baseurl').val();
            var modules = getModule();
            $.ajax({
                @* url : bs+"user/get/data", *@
                url : ajax.url.get_users,
                type : "GET",
                dataType: "json",
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        clearTable($('#tbldataUser'));
                        var html = "";
                        var nn = 0;
                        var username = $('#id_username').val();
                        var prefix = "";
                        $('.count-to-user').countTo({
                            from: 0,
                            to: data.collection.length,
                            onUpdate: function (value) {
                                var innerText = this.text() + prefix;
                            },
                        });

                        $.each(data.collection, function(index, item){
                            nn++;
                            var alt = item.is_disactived == 1 ? "Disactivated" : "Activated";
                            var style = item.is_disactived == 1 ? 'style="background:#eee;" ' : '';
                            html += '<tr alt="'+alt+'" '+style+' >'
                            html += '<td>'+nn+'</td>';
                            html += '<td style="width:150px;">'+item.name+'</td>';
                            html += '<td>'+item.group_name+'</td>';
                            html += '<td>'+item.username+'</td>';
                            html += '<td>*********</td>';
                            html += '<td>';
                            html += '<div class="btn-group">\
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\
                                        ACTION <span class="caret"></span>\
                                    </button>\
                                    <ul class="dropdown-menu">';
                             html += '<li><a href="#" onclick="editData($(this))" data-id="'+item.id+'" data-id="'+item.username+'" >Detail</a></li>';
                             if(item.is_disactived == 1){
                               html += '<li><a href="#" onclick="disableData($(this), 0)" data-id="'+item.id+'" data-name="'+item.name+'" data-status="0" >Activated</a></li>';
                             }else{
                                html += '<li><a href="#" onclick="disableData($(this), 1)" data-id="'+item.id+'" data-name="'+item.name+'" data-status="1" >Disactivated</a></li>';
                                
                             }
                             html += '<li role="separator" class="divider"></li>';
                             if(username != item.username){
                                html += '<li><a href="#" onclick="removeData($(this))" data-id="'+item.id+'" data-name="'+item.name+'" >Delete</a></li>';
                             }
                             
                             html += '</ul> \
                                </div>';
                            
                            html += '</td>';
                            html += '</tr>';
                        })
                        $('#tbldataUser tbody').html(html);

                        initTable($('#tbldataUser'));
                    }else{
                        var msg = "Your session is expired, login again !!!";
                        showNotification('alert-danger', msg,'top','center')
                    }
                    $('#id_loader').html('');
                },
                error: errorAjax
            })
        }
        function initGroup(){
            var bs = $('#id_baseurl').val();
            var modules = getModule();
            $.ajax({
                @* url : bs+"user/get/group", *@
                url : ajax.url.get_groups,
                type : "GET",
                dataType: "json",
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        clearTable($('#tbldataGroup'));
                        var html = "";
                        var nn = 0;
                        dataGroup = data.collection;
                        var prefix = "";
                        $('.count-to-group').countTo({
                            from: 0,
                            to: data.collection.length,
                            onUpdate: function (value) {
                                var innerText = this.text() + prefix;
                            },
                        });
                        $.each(data.collection, function(index, item){
                            nn++;
                            html += '<tr onclick="detailGroup($(this))" data-id="'+item.id+'" data-name="'+item.name+'"  style="cursor:pointer;">'
                            html += '<td>'+nn+'</td>';
                            html += '<td style="width:150px;">'+item.name+'</td>';
                            html += '<td>';
                            html += '<button \
                                 onclick="detailGroup($(this))" \
                                 data-id="'+item.id+'" \
                                 data-name="'+item.name+'" \
                                 type="button" class="btn btn-info waves-effect">Detail</button>';
                            html += '</td>';
                            html += '</tr>';
                        })
                        $('#tbldataGroup tbody').html(html);
                        initTable($('#tbldataGroup'), false, false, 10,false);
                    }else{
                        var msg = "Your session is expired, login again !!!";
                        showNotification('alert-danger', msg,'top','center')
                    }
                    $('#id_loader').html('');
                },
                error: errorAjax
            })
        }
        function detailGroup(t){
            var id = t.data('id');
            var bs = $('#id_baseurl').val();
            $.ajax({
                @* url : bs+"user/get/group/detail/"+id, *@
                url : ajax.url.get_group_detail + `/${id}`,
                type : "GET",
                dataType: "json",
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        var col = data.collection;
                        $('#id_detail_name').val(col.name);
                        $('#id_detail_id').val(col.level_id);
                        var desc = JSON.parse(data.collection.description);
                        var html = "";
                        $.each(desc, (i, itm)=>{
                            var obj = itm;

                            html += '<div class="row clearfix">';
                            html += '   <div class="col-xs-12">';
                            html += '       <div class="card">';
                            html += '           <div class="header">';
                            html += '           <h4><i class="material-icons col-blue">check_circle</i> '+obj['name'] +'</h4>';
                            html += '           <small>'+obj['desc']+'</small>'
                            html += '           </div>';
                            html += '           <div class="body responsive">';
                            html += '               <ul class="list-group">';
                            $.each(obj['detail'], (index, item)=>{
                            html += '               <li class="list-group-item"><i class="material-icons col-blue">check_box</i> <b>'+item + '</b></li>';
                            })
                            html += '               </ul>';
                            html += '           </div>';
                            html += '       </div>';
                            html += '   </div>';
                            html += '</div>';
                       })
                       $('#id_mdl_detail_group').modal('show');
                       $('#id_area_privileges').html(html);
                    }else{
                        var msg = "Your session is expired, login again !!!";
                        showNotification('alert-danger', msg,'top','center')
                    }
                    $('#id_loader').html('');
                },
                error: errorAjax
            })
        }
        function editData(t){
            initPassword();
            var id = t.data('id');
            var bs = $('#id_baseurl').val();
            var modules = getModule();
            $('#frm_update')[0].reset();
            assetsImageUrl = "";
            $.ajax({
                @* url : bs+"user/get/user/detail/"+id, *@
                url : ajax.url.get_user_by_id + `/${id}`,
                type : "GET",
                dataType: "json",
                beforeSend: function(){
                    $('#id_loader').html('<div class="linePreloader"></div>');
                },
                success:function(data){
                    if(data.status == "success"){
                        var input = data.collection;
                        var listAccess = getAccess();
                        $('#id_edt_username').val(input['username']);
                        $('#id_edt_id').val(input['id']);
                        $('#id_edt_password').val(input['password']);
                        var html = "";
                        var htmlSel = "";
                        var htmlAccessSel = "";
                        html += '<option value="">Choose Group</option>';
                        $.each(dataGroup, (index,item)=>{
                            var seelcted = input['level_id'] == item.id ? "selected" : "";
                            html += '<option '+seelcted+' value="'+item.id+'">'+item.name+'</option>';
                        });

                        $.each(selActivate, (index,item)=>{
                            var seelcted = input['is_disactived'] == index ? "selected" : "";
                            htmlSel += '<option '+seelcted+' value="'+index+'">'+item+'</option>';
                        });

                        var userAccessData = input['access_id'];
                        var spUserAccessData = userAccessData.split("#");
                        $.each(listAccess, (index,item)=>{
                            var seelcacsted = spUserAccessData.includes(item.access_id) ? "selected" : "";
                            htmlAccessSel += '<option '+seelcacsted+' value="'+item.access_id+'">'+item.access_name+'</option>';
                        });


                        $('#id_edt_level_id').html(html);
                        $('#id_edt_activate_id').html(htmlSel);
                        $('#id_edt_access_id').html(htmlAccessSel);
                        enable_datetimepicker()
                        select_enable()
                        $('#id_mdl_update').modal('show');
                    }else{
                        var msg = "Your session is expired, login again !!!";
                        showNotification('alert-danger', msg,'top','center')
                    }
                    $('#id_loader').html('');
                    
                },
                error: errorAjax
            })
        }

        function disableData(t, st){
            var ss = st == 1 ? "Disactivated" : "Activated";
            var sd = st == 1 ? "disactivate" : "activate";
            var id = t.data('id');
            var name = t.data('name');
            var status = t.data('status');
            var form = new FormData();
            form.append('id', id);
            form.append('name', name);
            form.append('is_disactived', status);
            Swal.fire({
                title:'Are you sure you want '+sd+' it?',
                text: "You will change status user account "+name+" !",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: ss+' !',
                cancelButtonText: 'Cancel !',
                reverseButtons: true
                }).then((result) => {
                    if (result.value) {
                        var bs = $('#id_baseurl').val();
                        $.ajax({
                            @* url : bs+"user/post/user/disable", *@
                            url : ajax.url.post_disable_user,
                            type: "POST",
                            data : form,
                            processData: false,
                            contentType: false,
                            dataType :"json",
                            beforeSend: function(){
                                $('#id_loader').html('<div class="linePreloader"></div>');
                            },
                            success:function(data){
                                $('#id_loader').html('');
                                if (data.status == "success") {
                                    showNotification('alert-success', "Succes deleted user "+name ,'top','center')
                                    init();
                                }else{
                                    showNotification('alert-danger', "Data not found",'bottom','left')
                                }
                            },
                            error: errorAjax,
                        })
                    }
                else{

                }
            })
            
        }
        function removeData(t){
            var id = t.data('id');
            var name = t.data('name');
            var status = t.data('status');
            var form = new FormData();
            form.append('id', id);
            Swal.fire({
                title:'Are you sure you want delete it?',
                text: "You will lose the data user "+name+" !",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Delete !',
                cancelButtonText: 'Cancel !',
                reverseButtons: true
                }).then((result) => {
                    if (result.value) {
                        var bs = $('#id_baseurl').val();
                        $.ajax({
                            @* url : bs+"user/post/user/delete", *@
                            url : ajax.url.post_delete_user,
                            type: "POST",
                            data : form,
                            processData: false,
                            contentType: false,
                            dataType :"json",
                            beforeSend: function(){
                                $('#id_loader').html('<div class="linePreloader"></div>');
                            },
                            success:function(data){
                                $('#id_loader').html('');
                                if (data.status == "success") {
                                    showNotification('alert-success', "Succes deleted user "+name ,'top','center')
                                    init();
                                }else{
                                    showNotification('alert-danger', "Data not found",'bottom','left')
                                }
                            },
                            error: errorAjax,
                        })
                    }
                else{

                }
            })
            
        }

        function errorAjax(xhr, ajaxOptions, thrownError){
            $('#id_loader').html('');
            if(ajaxOptions == "parsererror"){
                var msg = "Status Code 500, Error Server bad parsing";
                showNotification('alert-danger', msg,'bottom','left')
            }else{
                var msg ="Status Code "+ xhr.status + " Please check your connection !!!";
                showNotification('alert-danger', msg,'bottom','left')
            }
        }
    </script>
}