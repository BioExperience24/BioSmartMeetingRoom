@page
@model _1.PAMA.Razor.Views.Pages.AuthenticationModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Favicon-->
    @* <link rel="icon" href="<?= base_url()?>download/media-icon" type="image/png"> *@
    <!-- Bootstrap Core Css -->
    <link href="~/assets/theme/plugins/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="~/assets/theme/plugins/bs-select/select.css">
    <link href="~/assets/theme/plugins/iconfont/material-icons.css" rel="stylesheet">
    <!-- Waves Effect Css -->
    <link href="~/assets/theme/plugins/node-waves/waves.css" rel="stylesheet" />
    <!-- Animation Css -->
    <link href="~/assets/theme/plugins/animate-css/animate.css" rel="stylesheet" />
    <!-- Morris Chart Css-->
    <!-- <link href="<?php echo base_url("assets/theme/plugins/morrisjs/morris.css") ?>" rel="stylesheet" /> -->
    <!-- Custom Css -->
    <link href="~/assets/theme/css/style.css" rel="stylesheet">
    <!-- AdminBSB Themes. You can choose a theme from css/themes instead of get all themes -->
    <link href="~/assets/theme/css/themes/all-themes.css" rel="stylesheet" />

    <style>
        .linePreloader {
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, green, green);
            background-color: #ccc;
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 4px;
            background-size: 20%;
            background-repeat: repeat-y;
            background-position: -25% 0;
            animation: scroll 1.2s ease-in-out infinite;
        }
    </style>
</head>
<body class="login-page" style="center no-repeat;background-size:cover;" )">
    <div class="login-box">
        <div class="logo">
            <a href="javascript:void(0);">
                <span class="base_color1">Meeting</span><b class="base_color2">Portal</b>
            </a>
            <small>Demo Smart Meeting v1.0</small>
        </div>
        <div class="card">
            <div class="body">
                <div id="id_loader"></div>
                <form id="sign_in" method="POST" onsubmit="return false;">
                    <div class="msg">Sign in to start your session</div>
                    <!-- <div class=""></div> -->
                    <div class="input-group">
                        <span class="input-group-addon">
                            <i class="material-icons">person</i>
                        </span>
                        <div class="form-line">
                            <input type="text" class="form-control" name="username" placeholder="Username " required autofocus>
                        </div>
                    </div>
                    <div class="input-group">
                        <span class="input-group-addon">
                            <i class="material-icons">lock</i>
                        </span>
                        <div class="form-line">
                            <input type="password" class="form-control" name="password" placeholder="Password" required>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12 p-t-5">
                        </div>
                        <div class="col-xs-4">
                            <button type="submit" class="btn btn-success btn-circle-lg waves-effect waves-circle waves-float">
                                <i class="material-icons">keyboard_arrow_right</i>
                            </button>
                        </div>
                    </div>

                    <div class="row m-t-15 m-b--20">
                        <div class="col-xs-12">
                            <a style="text-decoration: underline;" href="https://drive.google.com/drive/folders/1sZeLEzlOyjK4bkNQ0eKUYz2kCPCu9TJA?usp=sharing" target="__blank">Click Here to Read Documentation & Manual Guide</a>
                        </div>
                        <!-- <div class="col-xs-6 align-right"> -->
                        <!--  -->
                        <!-- </div> -->
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Jquery Core Js -->
    <script src="~/assets/theme/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap Core Js -->
    <script src="~/assets/theme/plugins/bootstrap/js/bootstrap.js"></script>
    <!-- Slimscroll Plugin Js -->
    <script src="~/assets/theme/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>
    <!-- Waves Effect Plugin Js -->
    <script src="~/assets/theme/plugins/node-waves/waves.js"></script>
    <!-- Jquery CountTo Plugin Js -->
    <script src="~/assets/theme/plugins/jquery-countto/jquery.countTo.js"></script>
    <!-- Custom Js -->
    <script src="~/assets/theme/js/admin.js"></script>
    <!-- <script src="<?php echo base_url("assets/theme/js/pages/index.js" ></script> -->
    <!-- Demo Js -->
    <script src="~/assets/theme/js/demo.js"></script>
    <!-- Select Plugin Js -->
    <script src="~/assets/theme/plugins/bootstrap-select/js/bootstrap-select.js"></script>
    <script src="~/assets/theme/plugins/bootstrap-notify/bootstrap-notify.js"></script>
    <script>
        // $(function () {
        //     $.AdminBSB.browser.activate();
        //     $.AdminBSB.leftSideBar.activate();
        //     $.AdminBSB.rightSideBar.activate();
        //     $.AdminBSB.navbar.activate();
        //     $.AdminBSB.dropdownMenu.activate();
        //     $.AdminBSB.input.activate();
        //     $.AdminBSB.select.activate();
        //     $.AdminBSB.search.activate();

        //     setTimeout(function () { $('.page-loader-wrapper').fadeOut(); }, 50);
        // });
        //
        function showNotification(colorName, text, placementFrom, placementAlign, animateEnter, animateExit) {
            if (colorName === null || colorName === '') { colorName = 'bg-black'; }
            if (text === null || text === '') { text = 'Turning standard Bootstrap alerts'; }
            if (animateEnter === null || animateEnter === '') { animateEnter = 'animated fadeInDown'; }
            if (animateExit === null || animateExit === '') { animateExit = 'animated fadeOutUp'; }
            var allowDismiss = true;

            $.notify({
                message: text
            },
                {
                    z_index: 9999,
                    type: colorName,
                    allow_dismiss: allowDismiss,
                    newest_on_top: true,
                    timer: 1000,
                    placement: {
                        from: placementFrom,
                        align: placementAlign
                    },
                    animate: {
                        enter: animateEnter,
                        exit: animateExit
                    },
                    template: '<div data-notify="container" class="bootstrap-notify-container alert alert-dismissible {0} ' + (allowDismiss ? "p-r-35" : "") + '" role="alert">' +
                    '<button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button>' +
                    '<span data-notify="icon"></span> ' +
                    '<span data-notify="title">{1}</span> ' +
                    '<span data-notify="message">{2}</span>' +
                    '<div class="progress" data-notify="progressbar">' +
                    '<div class="progress-bar progress-bar-{0}" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>' +
                    '</div>' +
                    '<a href="{3}" target="{4}" data-notify="url"></a>' +
                    '</div>'
                });
        }
    </script>
    <script src="~/assets/theme/plugins/jquery-validation/jquery.validate.js"></script>

    <script>
           $(function () {
               $('#sign_in').validate({
                   highlight: function (input) {
                       // console.log(input);
                       $(input).parents('.form-line').addClass('error');
                   },
                   unhighlight: function (input) {
                       $(input).parents('.form-line').removeClass('error');
                   },
                   errorPlacement: function (error, element) {
                       $(element).parents('.input-group').append(error);
                   },
                   submitHandler: function(form) {
                       // $('#sign_in')[0].submit();
                       // console.log(form)
                       //
                   }

               });
               // console.log(d);
           });
           $('#sign_in').submit(function(e){
                // Ambil URL saat ini\
                const currentUrl = new URL(window.location.href);

                // Tambahkan atau ubah query parameter
                currentUrl.searchParams.set('handler', 'Login');

                // Simpan hasil ke variabel tanpa mengubah URL asli
                const updatedUrl = currentUrl.toString();
               e.preventDefault();
               if($(this).valid() == false){
                   return false;
               }
               $.ajax({
                    @* url: '/Authentication?handler=Login', // URL menuju handler *@
                    url: updatedUrl, // URL menuju handler
                    type: 'POST',
                    dataType : "json",
                    data: $(this).serialize(),
                   beforeSend: function(XMLHttpRequest){
                       $('#id_loader').html('<div class="linePreloader"></div>');
                   },
                   success: function(data){
                       // console.log(data)

                       if(data.status == "fail"){
                           $('#id_loader').html('');
                           showNotification('alert-danger', data.msg,'bottom','left')
                       }else if(data.status == "success"){
                           showNotification('alert-success', "Success, please wait for redirect.",'bottom','left')
                           setTimeout(function(){
                               $('#id_loader').html('');
                               @* window.location.href = "./"; *@
                               window.location.href = data.collection;
                           }, 1000);
                       }

                   },
                   error: function (xhr, ajaxOptions, thrownError) {
                       $('#id_loader').html('');
                       // console.log("Error :> ", xhr.status);
                       if(ajaxOptions == "parsererror"){
                           var msg = "Status Code 500, Error Server bad parsing";
                           showNotification('alert-danger', msg,'bottom','left')
                       }else{
                           var msg ="Status Code "+ xhr.status + " Please check your connection !!!";
                           showNotification('alert-danger', msg,'bottom','left')
                       }
                       // console.log( ajaxOptions);
                   },
                   xhr: function()
                   {
                       var xhr = $.ajaxSettings.xhr();
                       xhr.onprogress = function e() {
                           // For downloads
                           if (e.lengthComputable) {
                               console.log(e.loaded / e.total, " progress");
                           }
                       };
                       xhr.upload.onprogress = function (e) {
                           // For uploads
                           if (e.lengthComputable) {
                               console.log(e.loaded / e.total, " progress upload");
                           }
                       };
                       return xhr;
                   },
               })
               // handleFormSubmit($('#sign_in'));
           });
           // function handleFormSubmit(form, input) {
        //        // validate the form against the constraints
        //        var errors = validate(form, constraints);
        //        // then we update the form to reflect the results

        //    }
    </script>
</body>
</html>
